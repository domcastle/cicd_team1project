REDIS_QUEUE = "ai:video:jobs"

def process_job(job):
    task_id = job["task_id"]
    user_id = job["user_id"]

    input_video = f"/var/lib/veo/videos/{user_id}/{task_id}.mp4"
    output_video = f"/var/lib/veo/processed/{user_id}/{task_id}.mp4"

    os.makedirs(os.path.dirname(output_video), exist_ok=True)

    if not os.path.exists(input_video):
        raise RuntimeError(f"Missing input video: {input_video}")

    subprocess.run([
        "/opt/ai/scripts/run_ffmpeg.sh",
        input_video,
        output_video
    ], check=True)
